IP层：
尽最大努力交付。

IP数据报检验和仅检验IP数据报首部，UDP检验和把数据部分和首部一起检验。
IP标志位最低位MF=1,表示后面还有分片；MF=0,表示后面没有分片。中间位DF=0，表示允许分片，否则不允许分片。
OSPF不使用UDP,TCP,直接IP数据报发送；RIP是应用层协议，在传输层使用UDP。
IP首部；
UDP首部；
文件传输协议
(1)FTP 客户/服务器端 使用 TCP连接
动态主机配置协议（DHCP)
邮件传输过程
传输层
服用分用；
UDP:
（1） 特点
无连接；
尽最大努力交付；
面向报文：UDP对应用层交下来的报文既不合并，也不拆分，保留报文的边界；添加首部后交给IP层。
没有拥塞控制，因此网络出现的拥塞不会使源主机发送速率降低。适合实时应用。
支持一对一，一对多，多对一，多对多方式通信。
首部开销小，只有八个字节，比TCP20个字节少；
没有拥塞控制，可能造成严重网络拥塞；

（2）
首部格式
8个字节，4个字段，每个字段2个字节；
源端口 ： 源端口号，在需要对方回信时选用，不需要时可以全0
目的端口 ：  目的端口号，在交付报文时必须使用；
首部长度 ：  UDP数据报的长度，最小值是8，仅有首部；
检验和 ：    检测UDP数据报在传输时是否有问题，有就丢弃；（伪首部检验，既不向上提交，也不向下传送，仅仅用于检验）


TCP:
(1) 特点
面向连接的传输层协议： 在使用TCP协议前，必须先建立连接 ， 传送结束后， 必须释放连接；
每一条TCP连接只能有两个端口，每一条TCP连接只能是点对点的。
提供可靠交付的服务。
全双工通信（发送缓存，接收缓存）。
面向字节流

理想传输条件：
(1)传输信道不产生差错
(2)不管发送方以多快的速率发送文件，接收方总是来得及处理收到的数据；
在这样的理想传输条件下，不采取任何措施就能实现可靠传输。然而实际网络不具备以上条件。我们可以使用一些可靠传输协议，当出现差错时让对方重传出现差错
的数据，同时在接收方来不及处理收到的数据时，及时告诉发送方适当降低发送数据的速度。这样一来，本来不可靠的信道就能实现可靠传输。

确认和重传机制，可以在不可靠的传输网络上实现可靠传输。
(1)在发送完一个分组后，必须暂时保留已发送的文件的副本；
(2)分组和确认分组都必须进行编号；
(3)超时计时器设置的重传时间必须比数据在分组传输的平均往返时间更长一点；

停等协议信道利用率低

连续ARQ协议：
累计确认（信道质量不好是回退带来不好的影响）

TCP首部格式
(1)源端口和目的端口  ：各占2个字节 TCP的分用也是通过端口实现。
(2)序号 ： 占四字节；
(3)确认号 : 四字节，期望收到对方下一个报文段的第一个数据字节的序号；
(4)数据偏移：四字节 ，单位四字节。指出TCP报文段的数据起始处距离TCP报文段的起始处有多远；实际指出TCP报文段首部长度，由于首部长度中还有长度
不确定的选项字节，因此数据偏移段是必要的。（最大值60字节）
(5)保留字段： 占六位，保留为今后使用，目前置为0。
(6)紧急URG :  URG=1, 表明紧急字段指针有效。告诉系统此报文段有紧急数据，应优先传送，URG置1时，发送方应用进程就告诉发送方的TCP有紧急数据需要传
送。于是发送方TCP就把紧急数据插入到本报文段数据的最前面。紧急数据后面的数据仍是普通数据。（这时要与首部中紧急指针字段配合使用）
(7)确认ACK : 仅当ACK=1时，确认号字段才有效。TCP规定，连接建立后所有传送的报文段都必须把ACK置为1。
(8)推送PSH :  两个应用进程进行交互通信时，有时在一端的通信方希望在键入一个命令后能立刻得到对方的响应，在这种情况下，推送方就可以使用推送操作。
发送方把PSH置1，接收方接收到就尽快交付，不用等缓存满在交付。
(9)复位RST(Reset)   RST=1,表明TCP连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。
(10)同步SYN : 在连接建立时用来同步序号。SYN=1表示这是一个连接请求或连接接受报文。
(11)终止FIN : FIN为1时 ， 表示这一报文段的发送方的数据已发送完毕，要求释放运输连接。
(12)窗口 ： 占2字节 ，指的是发送本报文段的一方的接受窗口。窗口值告诉对方，从本报文段首部中的确认号算起，接收方目前允许对方发送的数据量。之所以有限制，
是因为接收方的数据缓存空间有限。
(13)检验和 ：伪首部第四字段17表示UDP, 6表示TCP; 检验和字段检验的字段包括首部，数据字段。
(14)紧急指针 ： 2字节，只有在URG=1时才有意义，它指出本报文段中的紧急数据的字节数（紧急数据结束后就是普通数据），因此，紧急指针指出了紧急数据的末尾
在报文段中的位置。(当所有紧急数据处理完，TCP就告诉应用程序恢复正常）
(15)选项 ： 长度可变，最长40字节，没有使用选项，TCP首部长度20字节。
选项开始只有MSS,是每一个TCP报文段数据部分最大长度。
扩大窗口选项 最大可扩大14字节
时间戳选项 :时间戳值字段和时间戳回送回答字段
（a) 计算RTT;
（b) 处理TCP序号超过2^32重复情况。
(16) 填充字段 使首部字段是16倍数。

TCP可靠传输实现
(1)以字节为单位滑动窗口
(2)超时重传时间选择
(3)选择确认SACK
TCP流量控制
流量控制：让发送方发送速率不要太快，接收方要来得及接收。
（接收到0窗口之后启动持续计时器，持续计时器时间到，发送零窗口探测报文段）持续计时器解决死锁


TCP传输效率
(1)维持一个变量， 等于MSS;
(2)发送方应用进程指明要求发送报文段(使用push)
(3)发送方计时器时限到
Nagle算法(发送方)(收到接收方确认再发送,不急着发送）
糊涂窗口综合症(接收方)(接收方等待一段时间，或缓存有一半空闲空间，不急着在缓存空间很小时把信息告诉发送方)

TCP拥塞控制
拥塞控制是一个全局性的过



































